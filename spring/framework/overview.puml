@startuml overview

package aop{
    class TargetClassAware{

    }
}

interface Advised{
--
管理target, advisor之類的配置的地方
}

class ProxyConfig{
--
放各種setting的地方
}

class AdvisedSupport{
    + setTarget(target)
    + addAdvisor(Advisor)
    + adviseChanged()
--
實作Advised，管理通知advisor
}

class ProxyCreatorSupport{
    - listeners: AdvisedSupportListener[]
    - aopProxyFactory: AopProxyFactory
    + setAopProxyFactory(AopProxyFactory)
    + adviseChanged()
    + activate()
    + createAopProxy(): AopProxy
--
proxy factory的基礎類別
用一個簡單的方式使用AopProxyFactory
**Observer pattern**
}

note right of ProxyCreatorSupport
void adviseChanged(){
    for l in listeners
        l.adviseChanged()
}

void activate(){
    for l in listeners
        l.activate()
}

AopProxy createAopProxy(){
    return this.aopProxyFactory.createAopProxy()
}
end note

ProxyCreatorSupport --> AopProxyFactory

interface AdvisedSupportListener{
    + activate()
    + adviceChanged()
}

ProxyCreatorSupport --> AdvisedSupportListener : notify
AdvisedSupportListener --> ProxyCreatorSupport : attach

class ProxyFactory{
--
簡單的得到AopProxy
}

class ProxyFactoryBean{
--
用XML之類的建立proxy 
**Strategy Pattern的不同Context**
}

TargetClassAware <|-- Advised
Advised <|.. AdvisedSupport
ProxyConfig <|-- AdvisedSupport
AdvisedSupport <|-- ProxyCreatorSupport
ProxyCreatorSupport <|-- ProxyFactory
ProxyCreatorSupport <|-- ProxyFactoryBean

interface AopProxyFactory{
    + createAopProx(): AopProxy
    --
    **Strategy pattern**
}

class DefaultAopProxyFactory{
--
根據條件create AopProxy
**simple factory pattern**
}

note bottom of DefaultAopProxyFactory
if(cond A)
    create ObjenesisCglibAopProxy
else if(cond B)
    create JdkDynamicAopProxy
end note

AopProxyFactory <|.. DefaultAopProxyFactory

interface AopProxy{
    + getProxy(): Object
    --
    產生負責處理切面的Proxy
}

class CglibAopProxy{

}

class ObjenesisCglibAopProxy{

}

CglibAopProxy <|-- ObjenesisCglibAopProxy

class JdkDynamicAopProxy{

}

AopProxy <|.. CglibAopProxy
AopProxy <|.. JdkDynamicAopProxy
AopProxyFactory ..> AopProxy : create

@enduml