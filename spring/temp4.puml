@startuml
skinparam linetype ortho
skinparam nodesep 60
skinparam ranksep 60
skinparam groupInheritance 2

' --- 1. Target Interface (Spring AOP Standard) ---
package "Target Interface (Spring AOP)" #DDFFDD {
    interface "MethodBeforeAdvice" as TargetBefore {
        + before()
    }
    interface "MethodInterceptor" as TargetAround {
        + invoke()
    }
}

' --- 2. Adapter (The Bridge) ---
package "Adapter Layer (org.springframework.aop.aspectj)" #E0E0FF {
    abstract class AbstractAspectJAdvice {
        # aspectJAdviceMethod : Method
        # aspectInstanceFactory : AspectInstanceFactory
        + invokeAdviceMethod()
        ..
        <color:Red>1. Uses Factory to get Instance</color>
        <color:Red>2. Uses Reflection to invoke Method</color>
    }

    class AspectJMethodBeforeAdvice {
        + before()
    }
    
    class AspectJAroundAdvice {
        + invoke()
    }

    class AspectJAfterReturningAdvice
    class AspectJAfterThrowingAdvice
    
    interface AspectInstanceFactory {
        + getAspectInstance() : Object
        --
        <color:Blue>Factory Pattern</color>
    }

    class SingletonAspectInstanceFactory
    class SimpleAspectInstanceFactory
}

' --- 3. Adaptee (User Code / Weaver Object) ---
package "Adaptee (User Defined / Weaver Object)" #FFEEEE {
    class "UserLoggingAspect\n(@Aspect)" as UserAspect {
        + logBefore()
        + checkSecurityAround()
        --
        <color:DarkRed>Plain Java Object (POJO)</color>
        <color:DarkRed>No Spring Interfaces implementation</color>
    }
}

' --- Relationships for Adapter Pattern ---

' Realization (Adapter implements Target)
TargetBefore <|.. AspectJMethodBeforeAdvice
TargetAround <|.. AspectJAroundAdvice

' Inheritance
AbstractAspectJAdvice <|-- AspectJMethodBeforeAdvice
AbstractAspectJAdvice <|-- AspectJAroundAdvice
AbstractAspectJAdvice <|-- AspectJAfterReturningAdvice
AbstractAspectJAdvice <|-- AspectJAfterThrowingAdvice

' Factory Relationships
AbstractAspectJAdvice o-right- AspectInstanceFactory
AspectInstanceFactory <|.. SingletonAspectInstanceFactory
AspectInstanceFactory <|.. SimpleAspectInstanceFactory

' The "Adaptation" Link (Crucial Part)
SingletonAspectInstanceFactory .down.> UserAspect : returns instance >
SimpleAspectInstanceFactory .down.> UserAspect : creates instance >

AbstractAspectJAdvice .down.> UserAspect : <color:Red><b>Reflectively Invokes (Adapts)</b></color>

note right of AbstractAspectJAdvice
  **Adapter Logic:**
  1. Calls factory.getAspectInstance() -> gets UserAspect
  2. Calls method.invoke(instance) -> executes logBefore()
end note

@enduml